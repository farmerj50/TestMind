import{a as c}from"./chunk-SH4JKHKT.js";export*from"@clerk/backend";import g from"fastify-plugin";var p=["onRequest","preHandler"];import{AuthStatus as O}from"@clerk/backend/internal";import{createClerkClient as K}from"@clerk/backend";import{constants as C}from"@clerk/backend/internal";import{apiUrlFromPublishableKey as R}from"@clerk/shared/apiUrlFromPublishableKey";var u=process.env.CLERK_API_VERSION||"v1",n=process.env.CLERK_SECRET_KEY||"",f=process.env.CLERK_MACHINE_SECRET_KEY||"",i=process.env.CLERK_PUBLISHABLE_KEY||"",l=process.env.CLERK_API_URL||R(i),m=process.env.CLERK_JWT_KEY||"",E={name:"@clerk/fastify",version:"2.4.36",environment:"production"},{Cookies:H,Headers:h}=C;var a=K({secretKey:n,machineSecretKey:f,apiUrl:l,apiVersion:u,jwtKey:m,userAgent:"@clerk/fastify@2.4.36",sdkMetadata:E});var y=e=>async(t,r)=>{let o=c(t),s=await a.authenticateRequest(o,{...e,secretKey:e.secretKey||n,publishableKey:e.publishableKey||i,acceptsToken:"any"});if(s.headers.forEach((k,d)=>r.header(d,k)),s.headers.get(h.Location))return r.code(307).send();if(s.status===O.Handshake)throw new Error("Clerk: handshake status without redirect");t.auth=s.toAuth()};var F=(e,t,r)=>{e.decorateRequest("auth",null);let o=t.hookName||"preHandler";if(!p.includes(o))throw new Error(`Unsupported hookName: ${o}`);e.addHook(o,y(t)),r()},S=g(F,{name:"@clerk/fastify",fastify:"5.x"});import{getAuthObjectForAcceptedToken as I}from"@clerk/backend/internal";var x=e=>`\u{1F512} Clerk: ${e.trim()}

For more info, check out the docs: https://clerk.com/docs,
or come say hi in our discord server: https://clerk.com/discord
`,A=x(`The "clerkPlugin" should be registered before using the "getAuth".
Example:

import { clerkPlugin } from '@clerk/fastify';

const server: FastifyInstance = Fastify({ logger: true });
server.register(clerkPlugin);
`);var L=(e,t)=>{let r=e;if(!r.auth)throw new Error(A);return I({authObject:r.auth,acceptsToken:t?.acceptsToken})};export{a as clerkClient,S as clerkPlugin,L as getAuth};
//# sourceMappingURL=index.js.map